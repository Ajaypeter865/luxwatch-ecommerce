<!doctype html>
<html class="no-js" lang="zxx">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shop | eCommerce</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="site.webmanifest">
  <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/owl.carousel.min.css">
  <link rel="stylesheet" href="/css/flaticon.css">
  <link rel="stylesheet" href="/css/slicknav.css">
  <link rel="stylesheet" href="/css/animate.min.css">
  <link rel="stylesheet" href="/css/magnific-popup.css">
  <link rel="stylesheet" href="/css/fontawesome-all.min.css">
  <link rel="stylesheet" href="/css/themify-icons.css">
  <link rel="stylesheet" href="/css/slick.css">
  <link rel="stylesheet" href="/css/nice-select.css">
  <link rel="stylesheet" href="/css/style.css">



  <style>
    /* small helper to make active nav link show underline exactly like original */
    .properties__button .nav-item .nav-link.active {
      border-bottom: 3px solid #ff2020;
      color: #111;
      font-weight: 700;
    }

    /* make the nav links look same as original (no red button for New Arrivals) */
    .properties__button .nav-item .nav-link {
      color: #111;
      font-weight: 700;
      padding: 10px 18px;
      border-radius: 0;
    }

    /* maintain spacing exactly as before */
    .product-btn {
      margin-bottom: 40px;
    }

    /* ensure wishlist heart button stays the same look */
    .wishlist-btn {
      background: transparent;
      border: none;
      color: #ff2020;
      font-size: 18px;
      cursor: pointer;
    }

    /* your add-to-cart styling should remain in style.css; this script uses the form action for ajax */
  </style>
</head>

<body>
  <%- include('../partials/user/navbar') %>

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <%- include('../partials/user/_toastify', { success: success, error: error }) %>


      <main>
        <div class="slider-area">
          <div class="single-slider slider-height2 d-flex align-items-center">
            <div class="container">
              <div class="row">
                <div class="col-xl-12">
                  <div class="hero-cap text-center">
                    <h2>Shop</h2>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <section class="popular-items latest-padding">
          <div class="container">

            <div class="row product-btn justify-content-between mb-40">
              <div class="properties__button">
                <nav>
                  <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link <%= sort === 'newest' || !sort ? 'active' : '' %>" id="nav-home-tab"
                      href="/shop?<% if (category) { %>category=<%= encodeURIComponent(category) %>&<% } %>sort=newest"
                      role="tab" aria-controls="nav-home" aria-selected="<%= sort === 'newest' || !sort %>">
                      Newest Arrivals
                    </a>

                    <a class="nav-item nav-link <%= sort === 'high-low' ? 'active' : '' %>" id="nav-profile-tab"
                      href="/shop?<% if (category) { %>category=<%= encodeURIComponent(category) %>&<% } %>sort=high-low"
                      role="tab" aria-controls="nav-profile" aria-selected="<%= sort === 'high-low' %>">
                      Price High To Low
                    </a>

                    <li class="nav-item dropdown">
                      <a class="nav-item nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                        aria-haspopup="true" aria-expanded="false">Category</a>
                      <div class="dropdown-menu">
                        <% if (categories && categories.length> 0) { %>
                          <% categories.forEach(cat=> { %>
                            <a class="dropdown-item"
                              href="/shop?category=<%= cat.slug %><% if (sort) { %>&sort=<%= sort %><% } %>">
                              <%= cat.name %>
                            </a>
                            <% }) %>
                              <% } else { %>
                                <span class="dropdown-item disabled">No Categories</span>
                                <% } %>
                      </div>
                    </li>

                  </div>
                </nav>
              </div>
            </div>

            <div class="tab-content" id="nav-tabContent">
              <div class="tab-pane fade show active" id="nav-home" role="tabpanel">
                <div class="row">
                  <% if (products && products.length> 0) { %>
                    <% products.forEach(product=> { %>
                      <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                        <div class="single-popular-items mb-50 text-center">
                          <div class="popular-img">
                            
                            <% 
                                let imageUrl = '/img/default-product.jpg'; // Path to your default placeholder image

                                if (Array.isArray(product.image) && product.image.length > 0) {
                                    // If 'product.image' is an array (multiple uploads), use the first path
                                    imageUrl = product.image[0];
                                } else if (typeof product.image === 'string' && product.image.length > 0) {
                                    // If 'product.image' is a single string (single upload), use it directly
                                    imageUrl = product.image;
                                } 
                            %>
                            <img src="<%= imageUrl %>" alt="<%= product.name %>">
                            <div class="img-cap">
                              <span>
                                <form action="/shop/addtocart/<%= product._id %>" method="POST"
                                  class="add-to-cart-form">
                                  <button type="submit" class="add-to-cart-btn">
                                    Add to cart
                                  </button>
                                </form>
                              </span>
                            </div>

                            <div class="favorit-items">
                              <form action="/wishlist/add/<%= product._id %>" method="POST" class="d-inline">
                                <button type="submit" class="wishlist-btn" title="Add to Wishlist">
                                  <span class="flaticon-heart"></span>
                                </button>
                              </form>
                            </div>
                          </div>
                          <div class="popular-caption">
                            <h3><a href="/product/<%= product._id %>">
                                <%= product.name %>
                              </a></h3>
                            <span>₹ <%= product.price.toLocaleString('en-IN') %></span>
                          </div>
                        </div>
                      </div>
                      <% }) %>
                        <% } else { %>
                          <div class="col-12 text-center">
                            <p>No products available at the moment.</p>
                          </div>
                          <% } %>
                </div>
              </div>
            </div>
          </div>
        </section>

        <div class="shop-method-area">
          <div class="container">
            <div class="method-wrapper">
              <div class="row d-flex justify-content-between">
                <div class="col-xl-4 col-lg-4 col-md-6">
                  <div class="single-method mb-40">
                    <i class="ti-package"></i>
                    <h6>Free Shipping Method</h6>
                    <p>aorem ixpsacdolor sit ameasecur adipisicing elitsf edasd.</p>
                  </div>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-6">
                  <div class="single-method mb-40">
                    <i class="ti-unlock"></i>
                    <h6>Secure Payment System</h6>
                    <p>aorem ixpsacdolor sit ameasecur adipisicing elitsf edasd.</p>
                  </div>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-6">
                  <div class="single-method mb-40">
                    <i class="ti-reload"></i>
                    <h6>Easy Return Policy</h6>
                    <p>aorem ixpsacdolor sit ameasecur adipisicing elitsf edasd.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <%- include('../partials/user/footer') %>

        <script src="/js/vendor/modernizr-3.5.0.min.js"></script>
        <script src="/js/vendor/jquery-1.12.4.min.js"></script>
        <script src="/js/popper.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/jquery.slicknav.min.js"></script>
        <script src="/js/owl.carousel.min.js"></script>
        <script src="/js/slick.min.js"></script>
        <script src="/js/wow.min.js"></script>
        <script src="/js/animated.headline.js"></script>
        <script src="/js/jquery.magnific-popup.js"></script>
        <script src="/js/jquery.scrollUp.min.js"></script>
        <script src="/js/jquery.nice-select.min.js"></script>
        <script src="/js/jquery.sticky.js"></script>
        <script src="/js/contact.js"></script>
        <script src="/js/jquery.form.js"></script>
        <script src="/js/jquery.validate.min.js"></script>
        <script src="/js/mail-script.js"></script>
        <script src="/js/jquery.ajaxchimp.min.js"></script>
        <script src="/js/plugins.js"></script>
        <script src="/js/main.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.js"></script>

        <!-- <script>
          // ✅ Reusable Toastify function
          function showToast(message, success = true) {
            Toastify({
              text: message,
              backgroundColor: success
                ? "linear-gradient(to right, #00b09b, #96c93d)"
                : "linear-gradient(to right, #ff5f6d, #ffc371)",
              duration: 2500,
              close: true
            }).showToast();
          }

          // ✅ ADD TO CART AJAX
          $(document).on('click', '.add-to-cart-btn', function (e) {
            e.preventDefault();
            const form = $(this).closest('form');
            const productId = form.attr('action').split('/').pop();

            $.ajax({
              url: `/api/cart/add/${productId}`,
              type: 'POST',
              success: function (res) {
                if (res.success) {
                  showToast(res.message, true);

                  // update cart count in navbar (if you have element with id="cart-count")
                  if (res.totalItems !== undefined) {
                    $('#cart-count').text(res.totalItems);
                  }
                } else {
                  showToast(res.message, false);
                }
              },
              error: function () {
                showToast('Something went wrong while adding to cart', false);
              }
            });
          });

          // ✅ ADD TO WISHLIST AJAX
          $(document).on('click', '.wishlist-btn', function (e) {
            e.preventDefault();
            const form = $(this).closest('form');
            const productId = form.attr('action').split('/').pop();

            $.ajax({
              url: `/api/wishlist/add/${productId}`,
              type: 'POST',
              success: function (res) {
                if (res.success) {
                  showToast(res.message, true);
                  if (res.totalItems !== undefined) {
                    $('#wishlist-count').text(res.totalItems);
                  }
                } else {
                  showToast(res.message, false);
                }
              },
              error: function () {
                showToast('Error adding to wishlist', false);
              }
            });
          });
        </script> -->


        <script>
  // Toast function (you already have it)
  function showToast(message, success = true) {
    Toastify({
      text: message,
      backgroundColor: success
        ? "linear-gradient(to right, #00b09b, #96c93d)"
        : "linear-gradient(to right, #ff5f6d, #ffc371)",
      duration: 2500,
      close: true
    }).showToast();
  }

  // ⭐ ADD TO CART — AJAX
  $(document).on('click', '.add-to-cart-btn', function (e) {
    e.preventDefault();
    const form = $(this).closest('form');
    const productId = form.attr('action').split('/').pop();

    $.ajax({
      url: `/api/cart/add/${productId}`,
      type: 'POST',
      success: function (res) {
        if (res.success) {
          showToast(res.message, true);

          // ⭐ Update cart count in navbar
          if (res.totalItems !== undefined) {
            $('#cart-count').text(res.totalItems);
          }
        } else {
          showToast(res.message, false);
        }
      },
      error: function () {
        showToast('Something went wrong while adding to cart', false);
      }
    });
  });

  // ⭐ ADD TO WISHLIST — AJAX
  $(document).on('click', '.wishlist-btn', function (e) {
    e.preventDefault();
    const form = $(this).closest('form');
    const productId = form.attr('action').split('/').pop();

    $.ajax({
      url: `/api/wishlist/add/${productId}`,
      type: 'POST',
      success: function (res) {
        if (res.success) {
          showToast(res.message, true);

          // ⭐ Update wishlist count in navbar
          if (res.totalItems !== undefined) {
            $('#wishlist-count').text(res.totalItems);
          }
        } else {
          showToast(res.message, false);
        }
      },
      error: function () {
        showToast('Error adding to wishlist', false);
      }
    });
  });
</script>



</body>

</html>